<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                        
<mapper namespace="kr.or.kosta.semicolon.member.dao.MemberDao">

       <insert id="insert" parameterType="Member">
        <selectKey  keyProperty="memberNo" order="BEFORE" resultType="int">    
            SELECT SEQ_MEMBER.nextval FROM DUAL
        </selectKey>

        INSERT INTO member
            (
                member_no,
                id,
                password,
                email,
                address,
                name,
                postcode,
                phone,
                age,
                gender,
                app_token,
                session_id,
                session_limit
            )
            VALUES 
            (
                #{memberNo},
                #{id},
                #{password},
                #{email},
                #{address},
                #{name},
                #{postcode},
                #{phone},
                #{age},
                #{gender},
                #{appToken},
                #{sessionId},
                #{sessionLimit}
            )
    </insert>


    <select id="listAll" resultType="Member">
        SELECT  member_no    AS     "memberNo",
                id,
                password,    
                email,        
                address,        
                name,        
                postcode,    
                phone,        
                regdate,
                age,
                gender,
                app_token     AS  "appToken",
                session_id	  AS  "sessionId",
                session_limit AS  "sessionLimit"
        FROM member
    </select>
    
    <select id="select" resultType="Member" parameterType="String">
        SELECT  member_no    AS     "memberNo",
                id,
                password,    
                email,        
                address,        
                name,        
                postcode,    
                phone,        
                regdate,
                age,
                gender,
                app_token     AS  "appToken",
                session_id	  AS  "sessionId",
                session_limit AS  "sessionLimit"
        FROM member
        WHERE id = #{value}
    </select>
    
    <update id="update" parameterType="Member">
        UPDATE  member 
        SET     password = #{password},
                email = #{email},
                address = #{address},
                name = #{name},
                postcode = #{postcode},
                phone = #{phone}
    </update>
    
    <delete id="delete" parameterType="String">
        DELETE FROM member 
        WHERE  id = #{value} 
    </delete>
    
    <select id="isMember" parameterType="Member" resultType="Member">
         SELECT  member_no    AS     "memberNo",
                id,
                password,    
                email,        
                address,        
                name,        
                postcode,    
                phone,        
                regdate,
                age,
                gender,
                app_token     AS  "appToken",
                session_id	  AS  "sessionId",
                session_limit AS  "sessionLimit"
        FROM member
        WHERE id = #{id} 
        AND password = #{password}
    </select>
    
    <select id="readLogin" parameterType="string" resultType="Member">
        SELECT  id,
                password,    
        FROM   member
        WHERE  session_id = #{value} 
               AND session_limit > SYSDATE
    </select> 
    
    <update id="updateLogin" parameterType="Member">
        UPDATE member
        SET    session_id = #{sessionId}, 
               session_limit = #{sessionLimit} 
        WHERE  id = #{id}
    </update>
    
</mapper>
